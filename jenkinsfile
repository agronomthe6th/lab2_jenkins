pipeline {
    agent none // Мы определим агента внутри каждого stage

    stages {
        stage('Build') {
            agent {
                docker {
                    image 'gcc:latest'
                    args '-v /usr/bin/docker:/usr/bin/docker' 
                }
            }
            steps {
                checkout scm // Получить исходный код из репозитория
                sh 'make' // Сборка проекта с помощью Makefile
            }
        }
    }

    post {
        success {
            script {
                // Внутри этого блока у вас есть доступ к контексту ноды
                archiveArtifacts artifacts: 'main', onlyIfSuccessful: true // Архивировать исполняемый файл main
            }
        }
    }
}
